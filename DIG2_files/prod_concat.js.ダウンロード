const Util=(()=>{var e=e=>(Object.freeze(e),e);let n={},r=e=>{var t;n[e]||(n[e]=!0,(t=document.createElement("script")).src=e+(m?"?pid="+m:""),document.getElementsByTagName("head")[0].append(t))},a={};let o=(e,t)=>{Components[e]=t,a[e]||(a[e]={name:e,promise:Promise.resolve(!0),resolve:()=>{},loaded:!0}),Object.values(a).forEach(e=>{Components[e.name]&&!e.loaded&&e.resolve()})};let t={};let i=async e=>{e=(e.startsWith("iV")?"data:image/png;base64,":"data:image/jpeg;base64,")+e;return s(e)},s=async e=>{let n=document.createElement("img"),r;var t=new Promise(e=>{r=e});return n.addEventListener("load",()=>{var e=HTML.Canvas(),t=e.getContext("2d");e.width=n.width,e.height=n.height,t.drawImage(n,0,0),r(e)}),n.src=e,t};let l=(e,t)=>0===e?0:e&&"number"==typeof(e="string"==typeof e?parseFloat(e):e)&&!isNaN(e)&&isFinite(e)?e:t||0,u=(e,t)=>Math.floor(l(e)+.5,t);let d=e=>!1===e?"false":0===e?"0":e?e+"":"";let c=e=>{var t=(new TextEncoder).encode(e),n=[],r=t.length;for(let e=0;e<r;e++)n.push(t[e]);return n},g=t=>{var n,r=[],a=t.length;for(let e=0;e<a;e++)n=t[e],r.push(n>>6&3,n>>4&3,n>>2&3,3&n);for(;r.length%3!=0;)r.push(0);var o=[],e="abcdefghijklmnopqrstuvwxyz",i=(e.toUpperCase()+e.toLowerCase()+"0123456789+/").split("");for(let e=0;e<r.length;e+=3)o.push(i[r[e]<<4|r[e+1]<<2|r[e+2]]);for(;o.length%4!=0;)o.push("=");return o.join("")},p=(()=>{var e="abcdefghijklmnopqrstuvwxyz",t=e.toUpperCase()+e.toLowerCase()+"0123456789+/",n={};for(let e=0;e<t.length;e++)n[t.charAt(e)]=e;return n["-"]=62,n._=63,{...n}})();let m="";const h="2023-01-02";let f=e=>{var e=DateTime.toUnix(e)/1e3,t=DateTime.toUnix(h)/1e3,e=Math.floor((e-t)/86400+.5),t=Math.floor(e/7),e=4*t+(e-7*t)+1;return e<1?null:e},v=e=>{let t=""+e;t.startsWith("lesson-")&&(t=t.split("-")[1]||"");var n,e=u(t);return!e||(n=(e=e-1)-4*(e=Math.floor(e/4)),e<0)||50<e?null:DateTime.offsetDate(DateTime.toDateStruct(h),7*e+n)};let w=(e,t)=>{let n=null;var r=new Promise(e=>{n=e});let a=async()=>{await Promise.resolve(e())?n(!0):setTimeout(a,Math.floor(1e3*t))};return setTimeout(a,1),r},y={};let b=async t=>{if(y[t])return!!y[t].done||y[t].promise;let n=null;var e=new Promise(e=>{n=e}),r=(y[t]={promise:e,resolver:n},document.createElement("link"));r.href=""+t+(m?"?pid="+m:""),r.rel="stylesheet",document.head.append(r);return w(()=>0<Array.from(document.styleSheets).filter(e=>(e.href||"").split("?")[0].endsWith(t)).length,.05).then(()=>n(!0)),e};var T="0123456789abcdefghijklmnopqrstuvwxyz";let _=new Set((T+T.toUpperCase()).split(""));return e({asyncCohortDateIdToLessonNum:f,asyncCohortLessonNumToDateId:v,asyncCohortGetDateFromUrlDate:e=>d(e).startsWith("lesson-")?v(e):e,ensureCorrectCohortDateFormat:(e,t)=>{return e?(e=f(t))?"lesson-"+e:null:DateTime.toDateId(t,!0)},arrayFlatten:e=>{let n=[],r=e=>{if(Array.isArray(e))for(var t of e)r(t);else n.push(e)};return r(e),n},base64ToBytes:t=>{var n,r,a,o=[],i=t.length;for(let e=0;e<i&&"="!==(r=t.charAt(e));e++){if(void 0===(a=p[r]))return null;o.push(a>>4&3,a>>2&3,3&a)}for(;o.length%4!=0;)o.pop();var s=[];for(let e=0;e<o.length;e+=4)n=o[e]<<6|o[e+1]<<4|o[e+2]<<2|o[e+3],s.push(n);return s},blockRelease:()=>{let t;return{promise:new Promise(e=>{t=e}),resolver:t}},bytesToBase64:g,camelToKebabCase:e=>{let t=[];for(var n of e.split(""))n.toUpperCase()===n?t.push("-",n.toLowerCase()):t.push(n);return(t="-"===t[0]?t.slice(1):t).join("")},ensureArray:e=>"object"==typeof e&&Array.isArray(e)?e:[],ensureInteger:u,ensureNumber:l,ensureNumLength:(e,t)=>{let n=u(e)+"";for(;n.length<t;)n="0"+n;return n},ensureObject:e=>e&&"object"==typeof e&&!Array.isArray(e)?e:{},ensureString:d,freeze:e,generateGibberish:e=>{for(var t=[],n="abcdefghijklmnopqrstuvwxyz",r=n+n.toUpperCase()+"0123456789";t.length<e;)t.push(r[Math.floor(Math.random()*r.length)]);return t.join("")},getCachedImage:async e=>(t[e]||(t[e]=await s(e)),t[e]),getHumanSortedCopy:(e,n)=>{let t="0".charCodeAt(0),r="9".charCodeAt(0),i=e=>{e=e.charCodeAt(0);return e>=t&&e<=r};e=e.map(e=>{var t=d(n(e));return{originalKey:t,sortKey:(e=>{var t=e.trim().toLowerCase();if(0===t.length)return[];var n=[];let r=i(t[0]),a=[];for(let e=0;e<t.length;e++){var o=t[e];i(o)!==r?(n.push({isNum:r,value:a.join("")}),r=!r,a=[o]):a.push(o)}return n.push({isNum:r,value:a.join("")}),n.forEach(e=>{e.isNum&&(e.value=parseInt(e.value))}),n})(t),item:e}});return e.sort((e,t)=>{var n=e.sortKey,r=t.sortKey,a=Math.max(n.length,r.length);for(let e=0;e<a;e++){var o=n[e],i=r[e];if(!o)return-1;if(!i)return 1;if(o.isNum!==i.isNum)return o.isNum?-1:1;if(o.value!==i.value)return o.isNum?o.value-i.value:o.value.localeCompare(i.value)}return e.originalKey.localeCompare(t.originalKey)}),e.map(e=>e.item)},isBinding:e=>"object"==typeof e&&!!e.VC_IS_BINDING,kebabToCamelCase:e=>{var t=e.split("-");for(let e=1;e<t.length;e++)t[e]=t[e].length?t[e][0].toUpperCase()+t[e].substring(1):"";return t.join("")},loadComponent:async e=>{if(Components[e])return Promise.resolve(!0);if(a[e])return a[e].promise;let t,n={name:e,promise:new Promise(e=>{t=e}),resolve:()=>{n.loaded||(t(!0),n.loaded=!0)},loaded:!1};return a[e]=n,r(`/components/${e}/index.js`),n.promise},loadCss:b,loadCssInline:(e,t)=>{var n=document.createElement("style");n.innerHTML=t,document.head.append(n),y[e]={done:!0,promise:Promise.resolve(!0)}},loadImage:s,loadImageB64:i,loadImageBytes:async e=>i(g(e)),loadScript:r,nop:()=>{},pause:async t=>new Promise(e=>{setTimeout(()=>e(!0),Math.floor(1e3*t))}),pollTill:w,preRegisterComponent:e=>{if(!a[e]){let t;var n=new Promise(e=>{t=e});a[e]={name:e,promise:n,resolve:()=>{t(!0)},loaded:!1}}},registerComponent:o,registerComponentWithCss:(e,t)=>{b("/components/"+e+"/style.css").then(()=>o(e,t))},removeFalsyValues:e=>{var t,n={};for(t of Object.keys(e))e[t]&&(n[t]=e[t]);return n},setPid:e=>{m=e},stringToBase64:e=>{e=c(e);return g(e)},stringToBytesUtf8:c,throttleInvocation:(n,r)=>{let a=0,o=null;return{throttled:function(){let e=++a,t=Array.from(arguments);o=t,setTimeout(()=>{e===a&&n(...t)},r)},flush:()=>{o&&(a++,n(...o))}}},toAlphaNums:e=>d(e).split("").filter(e=>_.has(e)).join(""),trimSplit:(e,t)=>e.split(t).map(e=>e.trim()).filter(e=>!!e)})})(),HTML=(()=>{let t={"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;"};let e=()=>{r=r.filter(e=>{var t=e.element,n=w(t);if(!e.inTree&&n&&(e.inTree=!0),e.inTree){if(!n)return!1;var n=t.offsetWidth,r=t.offsetHeight,a=n+","+r;t._RESIZE_TRIGGER!==a&&(t._RESIZE_TRIGGER=a,e.callback(n,r))}return!0})},r=[];window.addEventListener("resize",e);var a,n=(e,t,n)=>{e[t]=n},o=r=>(e,t,n)=>{e[r]=Util.ensureInteger(n)},i=(e,t,n)=>{e[t]=Util.ensureString(n)},s=(e,t,n)=>{e[t]=Util.ensureInteger(n)};let l=(e,t,n)=>{e[t]="false"!==n&&!!n},u={"*.autocomplete":i,"*.bold":(e,t,n)=>{e.style.fontWeight=n?"bold":"normal"},"*.class":(t,e,n)=>{Util.arrayFlatten([n]).forEach(e=>t.classList.add(e+""))},"*.disabled":l,"*.html":(e,t,n)=>{e.innerHTML=n},"*.href":(e,t,n)=>{n=Util.ensureString(n);(n.startsWith("http://")||n.startsWith("https://"))&&(e.target="_blank"),e.href=n},"*.placeholder":n,"*.id":i,"*.italic":(e,t,n)=>{e.style.fontStyle=n?"italic":"normal"},"*.navigate":(e,t,n)=>{e.href=n,e.addEventListener("click",async e=>{e.preventDefault(),Router.forceNewTab(e.ctrlKey||e.metaKey),await Router.navigate(n),Router.forceNewTab(!1)})},"*.onElementResize":(e,t,n)=>{e._RESIZE_TRIGGER="",r.push({element:e,callback:n,inTree:!1})},"*.onEnterPressed":(t,e,n)=>{t.addEventListener("keydown",e=>{13===e.keyCode&&n(t)})},"*.spellcheck":l,"*.src":n,"*.text":(e,t,n)=>{e[a]=Util.ensureString(n)},"*.title":i,"*.value":n,"a.target":i,"button.onClick":(t,e,n)=>{t.addEventListener("click",async e=>{Router.forceNewTab(e.ctrlKey||e.metaKey),setTimeout(()=>Router.forceNewTab(!1),10),await Promise.resolve(n(e,t))})},"canvas.canvaswidth":o("width"),"canvas.canvasheight":o("height"),"canvas.src":(e,t,n)=>{var r=e.getContext("2d");e.width=n.width,e.height=n.height,r.drawImage(n,0,0)},"form.action":i,"input:checkbox.isChecked":(e,t,n)=>l(e,"checked",n),"input:checkbox.value":(e,t,n)=>l(e,"checked",n),"input:checkbox.onValueChanged":(e,t,n)=>{e.addEventListener("change",()=>{n(!!e.checked)})},"input:date.onDateChanged":(a,e,o)=>{a.addEventListener("input",()=>{var e={valid:!1,year:0,month:0,day:0},[t,n,r]=(""+a.value).split("-").map(e=>parseInt(e));t&&!isNaN(new Date(t,n-1,r).getFullYear())&&1900<t&&(e.year=t,e.month=n,e.day=r,e.valid=!0),o(e)})},"input:date.value":(e,t,n)=>{e.value=DateTime.toDateId(n)},"input:password.onTextChanged":(e,t,n)=>e.addEventListener("input",()=>n(e.value)),"input:text.onTextChanged":(e,t,n)=>e.addEventListener("input",()=>n(e.value)),"input:time.onTimeChanged":(r,e,a)=>{r.addEventListener("input",()=>{let e={valid:!1};var t,n=r.value.split(":");return 2===n.length&&(t=parseInt(n[0]),n=parseInt(n[1]),e={valid:!0,hour:t,minute:n}),a(e)})},"input:time.value":(e,t,n)=>{e.value=DateTime.toTimeId(n,!1,!0,!0)},"input:number.onValueChanged":(e,t,n)=>{let r="";var a=()=>{r!==e.value&&(r=e.value,n(e.value))};return e.addEventListener("input",a),e.addEventListener("change",a),e},"input.value":i,"option.selected":(e,t,n)=>{n&&(e.selected="selected",console.log("SElected!"))},"select.onValueChanged":(e,t,n)=>{e.addEventListener("change",()=>{n(e.value)})},"span:label.agoTime":(e,t,n)=>{e._STRING_TABLE_ARGS=n,e._STRING_TABLE_SPECIAL_KEY="agoTime";e.innerText=StringTable.getAgoTime(!n,Util.ensureInteger(n))},"span:label.date":(e,t,n)=>{n=DateTime.toDateId(Array.isArray(n)?n[0]:n);e.innerText=StringTable.getFormattedDate(n),e._STRING_TABLE_ARGS=[n],e._STRING_TABLE_SPECIAL_KEY="date"},"span:label.datetime":(e,t,n)=>{var[n,r,a]=Array.isArray(n)?n:[n],o=DateTime.toDateStruct(n),n=DateTime.toTimeStruct(n);o&&n?(o={...o,...n},e.innerText=StringTable.getFormattedDateTime(o,r,a),e._STRING_TABLE_ARGS=[o,r,a],e._STRING_TABLE_SPECIAL_KEY="datetime"):e.innerText="ERROR"},"span:label.month":(e,t,n)=>{n=Array.isArray(n)?n[0]:n;e.innerText=StringTable.getFormattedMonth(DateTime.toDateStruct(n)),e._STRING_TABLE_ARGS=[n],e._STRING_TABLE_SPECIAL_KEY="month"},"span:label.queriedData":(e,t,n)=>{let{fn:r,queryArgs:a,queryUnwrapper:o,converter:i,isHtml:s}=n;o=o||(e=>e);e._STRING_TABLE_ARGS={converter:e=>i(o(e)),fn:r,queryArgs:a,cache:{},isHtml:s},e._STRING_TABLE_SPECIAL_KEY=t,e.innerHTML=i(n.init)},"span:label.text":(e,t,n)=>{n=Array.isArray(n)?n:[n],e.innerText=(StringTable.getLabel(n[0],n.slice(1))||"")+"",e._STRING_TABLE_ARGS=n.slice(0),n=StringTable.getActiveLang();StringTable.setLangAttribute(e,n)},"span:label.time":(e,t,n)=>{var[n,r]=Array.isArray(n)?n:[n],n=DateTime.toTimeStruct(n);e.innerText=StringTable.getFormattedTime(n,r),e._STRING_TABLE_ARGS=[n,!!r],e._STRING_TABLE_SPECIAL_KEY="time"},"table.cellSpacing":s,"table.cellPadding":s,"td.colSpan":s,"td.rowSpan":s,"textarea.rows":s,"textarea.cols":s,"textarea.onTextChanged":(e,t,n)=>e.addEventListener("input",()=>n(e.value)),"textarea.value":i},d=(t,e,n,r)=>{var e=u[e+"."+n]||(e.startsWith("input:")?u["input."+n]:null)||u["*."+n];if(e)return e(t,n,r);n.startsWith("on")&&n.charAt(2).toUpperCase()===n.charAt(2)?(e=n.substring(2).toLowerCase(),t.addEventListener(e,e=>{r(e,t)})):t.style[n]=r},c=(n,r,a)=>{if(a){if(Array.isArray(a))for(let e=0;e<a.length;e++)c(n,r,a[e]);else if("string"==typeof a)switch(r){case"span:label":d(n,r,"text",a);break;case"input:text":case"input:password":case"textarea":case"input:date":d(n,r,"value",a);break;case"input:time":d(n,r,"value",a+"");break;default:n.append(a)}else if("object"==typeof a)if(a instanceof HTMLElement)n.append(a);else if(a.VC_IS_BINDING){let t=a;c(n,r,{value:t.getValue()}),c(n,r,e=>t.setValue(e)),t.registerListener(e=>c(n,r,{value:e}))}else{if("input:date"===r&&a.month)return d(n,r,{value:DateTime.toDateId(a)}),n;if("input:time"===r&&(void 0!==a.hour||void 0!==a.hr))return d(n,r,{value:DateTime.toTimeId(a)}),n;for(var e in a)d(n,r,e,a[e])}else if("function"==typeof a){let e;switch(r){case"button":e="onClick";break;case"input:date":e="onDateChanged";break;case"input:time":e="onTimeChanged";break;case"input:text":case"input:password":case"textarea":e="onTextChanged";break;case"input:checkbox":case"input:number":case"select":e="onValueChanged";break;default:throw new Error(r)}d(n,r,e,a)}else n.append(""+a);return n}},g=(t,n)=>(t.set=(...e)=>(c(t,n||t.tagName,e),t),t.clear=()=>(v(t),t),t),p=(e,t)=>{var[n,r]=e.split(":"),n=document.createElement(n);return r&&(n.type=r),g(n,e).set(t)};n=n=>(n.forScope=t=>m((...e)=>n(t.toUpperCase()+"_"+e[0],...e.slice(1))),n.forComponentScope=e=>n.forScope("COMPONENT_"+e),n);let m=n=>(n.css=(...e)=>{e=Util.arrayFlatten(e).filter(e=>!!e);let t=e.length?{class:e}:null;return(...e)=>n(...e).set(t)},n);const h={table:{cellSpacing:0},"input:text":{spellcheck:!(a="innerText")},textarea:{spellcheck:!1}};let f=t=>{let n=h[t];return m((...e)=>(n&&(e=[n,...e]),p(t,e)))},v=e=>{for(;e.firstChild;)e.removeChild(e.firstChild);return e},w=e=>{let t=e;for(;t;){if(t===document.body)return!0;t=t.parentElement}return!1};let y="0123456789abcdef".split(""),b="#000000".split("");let T=f("span:label"),_={clearChildren:v,componentArgFilter:(e,t)=>{let r=[],a={},o=new Set(Array.from(t));return Util.arrayFlatten([e]).forEach(n=>{if("object"!=typeof n||n instanceof HTMLElement||n.VC_IS_BINDING)r.push(n);else{let t={};Object.keys(n).forEach(e=>{o.has(e)?a[e]=n[e]:t[e]=n[e]}),r.push(t)}}),{htmlArgs:r,compArgs:a}},forceResizePass:()=>{e()},htmlEscape:e=>(""+e).split("").map(e=>t[e]||e).join(""),isInDomTree:w,makeElement:p,px:e=>Math.floor(e+.5)+"px",pt:e=>Math.floor(100*e)/100+"pt",rgb:(e,t,n)=>(b[1]=y[Math.floor(e)>>4&15],b[2]=y[15&Math.floor(e)],b[3]=y[Math.floor(t)>>4&15],b[4]=y[15&Math.floor(t)],b[5]=y[Math.floor(n)>>4&15],b[6]=y[15&Math.floor(n)],b.join("")),scrollWrap:(...e)=>HTML.Div.css("scrollwrap")(HTML.Div.css("scrollwrap__content")(e)),setSet:g,InputCheckbox:f("input:checkbox"),InputDate:f("input:date"),InputFile:f("input:file"),InputNumber:f("input:number"),InputPassword:f("input:password"),InputText:f("input:text"),InputTime:f("input:time"),Link:f("a"),LocAgo:m(e=>T({agoTime:e})),LocDate:m(e=>T({date:DateTime.toDateId(e)})),LocDateTime:m((e,t,n)=>T({datetime:[e,!!t,!!n]})),LocMonth:m((e,t)=>{e=DateTime.toDateId([Util.ensureNumLength(t||2e3,4),Util.ensureNumLength(e,2),"15"].join("-"));return T({month:[e,!!t]})}),LocQueriedData:m(e=>T({queriedData:e})),LocText:n(m(e=>T({text:e}))),LocTextDynamic:n(m((e,t)=>T({text:[e,...t.map(Util.ensureString)]}))),LocTime:m((e,t)=>T({time:[DateTime.toTimeStruct(e),!!t]})),NBSP:(...e)=>HTML.Span({html:"&nbsp;"},e),NBSPW:(...e)=>HTML.Span({html:"&nbsp;&nbsp;&nbsp;"},e)};var L=["Br","Button","Canvas","Div","Form","IFrame","Img","Li","Option","Select","Span","Table","Tbody","Td","Thead","TextArea","Tr","Ul"];for(let e=1;e<=6;e++)L.push("H"+e);return L.forEach(e=>{_[e]=f(e.toLowerCase())}),_.Binding=e=>{let r=e,a=[];e={VC_IS_BINDING:!0,getValue:()=>r,setValue:t=>{let n=r;r=t,a.forEach(e=>e(t,n))},registerListener:e=>{a.push(e)}};return Util.freeze(e)},Util.freeze(_)})(),API=(()=>{let i=null;let n=async(e,t,n)=>{let r;var a=new Promise(e=>{r=e}),e={fn:e,payload:t};return l.push(e),u.push(r),setTimeout(o,n?0:50),a},s=null;let o=async()=>{if(l.length){var e=[...l],t=[...u],n=(l=[],u=[],JSON.stringify({requests:e,version:i})),r=await(await fetch("/api",{method:"POST",headers:{"Content-Type":"application/json"},body:n})).json();if(1===e.length&&"common.images"===e[0].fn||await UserStore.updateProfiles(r.userData||[]),r.responses.length!==t.length)throw new Error;for(let e=0;e<t.length;e++){var a=r.responses[e],o=t[e];if(!a.ok)switch(Util.ensureString(a.error)){case"DENIED":case"VERSION_CHANGE":case"NOT_LOGGED_IN":case"SYSTEM_MESSAGE":s={id:a.error,info:a.info||""}}o(a)}}},l=[],u=[];return Util.freeze({clearCoreError:()=>{s=null},getCoreError:()=>s,send:n,sendSolitary:async(e,t)=>(o(),n(e,t,!0)),setVersion:e=>{i=e}})})(),Data=(()=>{let a=null;return Util.freeze({loadCalendar:e=>{throw new Error("Not implemented")},loadCodeCoffeeInventory:async()=>{return(await(async()=>{if(!a){let t;let e=new Promise(e=>{t=e});a={value:e,resolver:t};API.send("student.codecoffeelist",{}).then(e=>{let{ok:t,coffees:n}=e;let r=t?15:1;if(!t||a)a.resolver(n);else a={value:n,resolver:()=>{}};setTimeout(()=>{a=null},r*60)})}return a.value})()).map(e=>({...e,urlId:Util.camelToKebabCase(e.name)}))},loadEnrolledCohorts:async()=>{var e=await API.send("student.enrolledcohorts",{});return e.cohorts||[]}})})(),DateTime=(()=>{let e=()=>(new Date).getTime()/1e3;let r=e=>{let t;if(!e)return null;var n=typeof e;if("string"==n)if(e.includes("-"))t=e.split("-");else{if(8!==e.length)return null;t=[e.substring(0,4),e.substring(4,6),e.substring(6)]}else if("object"==n)t=[e.year,e.month,e.day].map(Util.ensureString);else{if("number"!=n)return null;e=new Date(1e3*n);t=[e.getFullYear(),e.getMonth()+1,e.getDate()]}var r,[n,e,a]=t.map(e=>parseInt(e));return isNaN(n)||isNaN(e)||isNaN(a)||n<1900||9999<n||e<1||12<e||a<1||(r={year:(r=new Date(n,e-1,a,12)).getFullYear(),month:r.getMonth()+1,day:r.getDate(),mondayOffset:(r.getDay()+6)%7},isNaN(r.year))||r.year!==n||r.month!==e||r.day!==a?null:r},a=(e,t)=>{e=r(e);return e?[e.year,Util.ensureNumLength(e.month,2),Util.ensureNumLength(e.day,2)].join(t?"":"-"):null},o=(e,t)=>{let n,r,a;if(!e)return null;if("string"==typeof e)[n,r,a]=e.split(":");else{if("object"!=typeof e)return null;n=""+(void 0===e.hour?e.hr:e.hour),r=""+(void 0===e.minute?e.min:e.minute),a=""+(e.second||e.sec||0)}var o,i;return n=parseInt(n),r=parseInt(r),a=parseInt(a)||0,isNaN(n)||isNaN(r)||isNaN(a)||n<0||23<n||r<0||59<r||a<0||59<a?null:(e=n<12,o=n%12||12,i=3600*n+60*r+a,t?{hr:n,hr12:o,min:r,sec:a,isAm:e,secondsPastMidnight:i}:{hour:n,hour12:o,minute:r,second:a,isAm:e,secondsPastMidnight:i})},i=(e,t,n,r)=>{e=o(e);return e?(r=[Util.ensureNumLength(e.hour,t||r?2:1),Util.ensureNumLength(e.minute,2)],n&&r.push(Util.ensureNumLength(e.seconds,2)),r.join(t?"":":")):null},s=e=>{e=r(e);return e?new Date(e.year,e.month-1,e.day,12,0,0).getTime():null};return Util.freeze({now:e,nowDateId:()=>{var e=new Date;return`${e.getFullYear()}-${Util.ensureNumLength(e.getMonth()+1,2)}-`+Util.ensureNumLength(e.getDate(),2)},nowInt:()=>Math.floor(e()),offsetDate:(e,t,n)=>{var e=s(e);return!e||(e=new Date(e+24*t*3600*1e3),isNaN(e.getFullYear()))?null:(t={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()},(n?r:a)(t))},offsetTime:(e,t)=>{var n,r,a="string"==typeof e,e=o(e);return e?({hour:e,minute:n,second:r}=e,n=(e=(3600*e+60*n+(r||0)+t)%86400+86400)%60,r=(e=Math.floor(e/60))%60,t=(e=Math.floor(e/60))%24+`:${r}:`+n,(a?i:o)(t)):null},subtractDates:(e,t)=>{e=s(e),t=s(t);return e&&t?Math.round((e-t)/24/3600/1e3):null},toDateId:a,toDateStruct:r,toTimeId:i,toTimeStruct:o,toUnix:s})})(),FeatureToggle=(()=>{let n="featureToggles",r=new Set((window.localStorage.getItem(n)||"").split(",").map(e=>e.trim().toUpperCase()).filter(e=>!!e));let t=(e,t)=>{e=e.trim().toUpperCase(),t?r.add(e):r.delete(e),window.localStorage.setItem(n,[...r].join(","))};return Object.freeze({isEnabled:e=>r.has(e.trim().toUpperCase()),enable:e=>t(e,!0),disable:e=>t(e,!1)})})(),IconStore=(()=>{let a={},o={},t={},n=async t=>{if(a[t])return a[t];if(o[t])return o[t];let n;var e=new Promise(e=>{n=e});o[t]=e;let r=document.createElement("img");return r.addEventListener("load",()=>{var e=HTML.Canvas({canvaswidth:r.width,canvasheight:r.height});e.getContext("2d").drawImage(r,0,0),a[t]=e,n(e)}),r.src="/images/"+t+".svg",e};let r=e=>{if(!e)return null;let n=HTML.Canvas({canvaswidth:e.width,canvasheight:e.height});return n.getContext("2d").drawImage(e,0,0),n.setSize=(e,t)=>(n.set({width:e+"px",height:t+"px"}),n),n};return{copyIcon:r,getIcon:async e=>{e=await n(e);return e?r(e):null},getIconDirect:n,getIconIds:()=>t,setIconIds:e=>{t=Util.freeze(e)}}})(),LayoutEngine=(()=>{let i=null,s="LOADING",l=null,o=null,u=null;const{Button:d,Div:c,H2:g,InputText:p,Link:m,LocText:h,NBSP:f,px:v}=HTML;let w=null;let y=!1,b=null;let T=()=>{_(!1)},_=e=>{y&&(y=!1,u.removeEventListener("click",T),u.set({display:"none"}),HTML.clearChildren(o),o.set({display:"none"}),b)&&b(e)},a=async(e,t)=>{var n=new Promise(e=>{b=e}),r=(t={...t||{}},c.css("float-window",t.destructive?"float-window--destructive":null)()),a=(t.headerText&&(a=c.css("float-window__header")(g.css("float-window__title")(t.headerText)),r.set(a)),void 0===t.includeClose||t.includeClose),a=(a&&r.set(d.css("float-window__close-button")({html:"&times"},()=>_())),r.set(e),t.hideBackground||r.set({backgroundColor:"#fff"}),u.set({display:"block"}),o.clear().set(r,{display:"flex"}),t.clickOutToClose&&u.addEventListener("click",T),y=!0,t.customPosition?()=>{["left","right","top","bottom"].forEach(e=>{void 0===t[e]?o.style.removeProperty(e):o.style[e]=v(t[e])})}:()=>{});return window.addEventListener("resize",a),a(),n};let e=0,t=!1,L=(window.addEventListener("popstate",()=>{t=!0}),()=>{t?(window.scroll(0,e),t=!1):window.scroll(0,0)});let S=(e,t,n)=>{"redirect"!==t&&window.location.pathname!==n&&window.history.pushState({url:n},"",n);t=HTML.clearChildren;t(l),l.append(e),HTML.forceResizePass()},r=Math.floor(16777215*Math.random()),E=async(e,t,n)=>{n=await A(e,t,n);return"MONO"!==s&&(s="MONO",HTML.clearChildren(i),i.set({backgroundImage:"url("+Branding.getBgImageUrl(1+r%Branding.bgImageCount())+")",backgroundSize:"cover",backgroundPosition:"center",position:"fixed"}),l=i),S(n,e,t)};const C=e=>{var t=document.getElementsByClassName("sidebar-container")[0],n=document.getElementsByClassName("sidebar-button")[0],r=document.getElementsByClassName("sidebar-icon")[0];!1===e||t.classList.contains("sidebar--open")?(n.classList.remove("sidebar-button--close"),r.classList.remove("sidebar-icon--hide"),t.classList.remove("sidebar--open")):(t.classList.add("sidebar--open"),n.classList.add("sidebar-button--close"),r.classList.add("sidebar-icon--hide"))};let I=null,P="";let A=async(e,t,n)=>{let r=await PageStore.getPage(e),a=(n=(n=!n&&r.urlParse?r.urlParse(t):n)||[],c.css("page-content")()),o;return r.loader?(a.set(h("LOADING").set({margin:"20px"})),API.clearCoreError(),Promise.resolve(r.loader(n)).then(e=>{var t=API.getCoreError();if(t)switch(t.id||""){case"DENIED":o=h("CORE_ERROR_DENIED");break;case"VERSION_CHANGE":o=h("CORE_ERROR_VERSION_CHANGE");break;case"NOT_LOGGED_IN":o=c(h("CORE_ERROR_NOT_LOGGED_IN"),f(),m(h("LOG_BACK_IN"),{navigate:"/login"}));break;case"SYSTEM_MESSAGE":o=c({margin:"40px",maxWidth:"600px",fontFamily:"monospace"},t.info);break;default:o=c(h("CORE_ERROR_UNKNOWN"))}else o=r.builder(e);a.clear().set(o),L()})):(o=r.builder(n),a.clear().set(o),L()),a};return Util.freeze({createFloatWindowPrompt:a,getProfileTile:()=>w,handleScroll:async()=>{void 0!==sessionStorage.getItem("scrollPosition")&&(e=Util.ensureNumber(sessionStorage.getItem("scrollPosition"))),sessionStorage.setItem("scrollPosition",window.scrollY)},hideFloat:_,initialize:()=>{i=c.css("root-container")(),u=c.css("float-window-bg")(),o=c.css("float-window-container")({display:"none",onClick:()=>{}}),document.body.append(i,u,o),l=i},isFloatShown:()=>y,setMonoPage:E,setPageInCurrentLayout:async(e,t,n)=>{if(!t)throw new Error;if("LOADING"===s)return E(e,t,n);n=await A(e,t,n);S(n,e,t)},setSidebarPage:async(e,t,n)=>{n=await A(e,t,n);if("SIDE"!==s){s="SIDE",HTML.clearChildren(i),i.set({backgroundImage:"none",backgroundSize:"auto",backgroundPosition:"left top",position:"static"});var r=c.css("sidebar-container")();(I=r).set(await SideBar.build()),P=SideBar.getCurrentFingerprint();let n=c.css("logo")();w=Components.ProfileTile(UserStore.getActiveUserId());var a=c.css("topbar")([c.css("topbar__left")(d.css("sidebar-button")(()=>{C()},c.css("sidebar-icon")(c.css("sidebar-icon__line")(),c.css("sidebar-icon__line")(),c.css("sidebar-icon__line")())),m.css("logo-container")(n,{navigate:"/"})),c.css("topbar__right")(Components.LanguageToggle(),w)]),o=async()=>{var e=window.innerWidth<600,t=await(e?Branding.getLogoIconOnly():Branding.getLogo());t.set({width:e||"dig"!==Branding.getId()?"100%":"28%",height:"100%"}),n.clear().set(t)},o=(o(),window.addEventListener("resize",o),l=c.css("page-content-container")({onClick:()=>{LayoutEngine.toggleSidebar(!1)}}),c.css("full-page-minus-topbar")(r,l));i.append(a,o)}return LayoutEngine.tickleSidebar(),S(n,e,t)},showPrompt:async(e,t)=>{var n=(t={...t||{}}).bodyText||null;let r=Util.ensureString(t.value),a=c({color:"#f00"});var o=t.confirmAction||h("OK");let i=async()=>{e=r;var e=await Promise.resolve(!!t.verifier&&t.verifier(e));return a.clear(),!!e&&(a.set(e),!0)};return LayoutEngine.createFloatWindowPrompt(c.css("float-window__content-wrapper")(c.css("float-window__content")(n,c(p(r,e=>{r=e})),c.css("float-window__button-container")(d(o,async()=>{var e=r;await i()||_(e)})),a)),{clickOutToClose:!0,includeClose:!1,headerText:e})},showYesNoDialog:async(e,t)=>{var n=(t={...t||{}}).positiveAction||"Yes",r=t.negativeAction||"No";return a(c.css("float-window__content-wrapper")(c.css("float-window__content","float-window__content--dialog")(c.css("float-window__body")(e)),c.css("float-window__footer")(c.css("float-window__button-container","float-window__button-container--dual","float-window__button-container--form")(d.css("float-window__ghost-button")(r,()=>_(!1)),d.css("float-window__primary-button",t.destructive?"float-window__primary-button--destructive":null)(n,()=>_(!0))))),{destructive:!!t.destructive,clickOutToClose:!0,includeClose:!1})},tickleSidebar:()=>{var e;I&&(e=SideBar.getCurrentFingerprint(),P!==e)&&I.clear().set(SideBar.build())},toggleSidebar:C})})(),PageStore=(()=>{let a=new Map,o={};let t=async n=>{var e;return r.has(n)||"koko"===n.split("-")[0]?a.has(n)?a.get(n):(e=new Promise(e=>{let t=o[n];t||(t=[],o[n]=t),t.push(e)}),Util.loadScript("/pages/"+n+".js"),e):t("not-found")},r=new Set;return Util.freeze({getPage:t,registerPage:(e,t)=>{let n="function"==typeof t?t():t;if(n.componentBody){let t=n.loader;n.loader=async e=>{var[e]=await Promise.all([t(e),Util.loadComponent(n.componentBody)]);return e},n.builder=e=>Components[n.componentBody](...e)}a.set(e,n);var r=o[e];if(r)for(;r.length;)r.pop()(n)},registerValidPageIds:function(e){e.forEach(e=>r.add(e))}})})(),Router=(()=>{let o=[],i="dashboard";let s={},l={};let u="?",e=async e=>{if(d)window.open(window.location.protocol+"//"+window.location.host+e,"_blank");else{u=e,LayoutEngine.hideFloat();var t,n=!!UserStore.getActiveUserId(),r=e.toLowerCase().split("/").filter(e=>e),a="/"+r.join("/"),e=r[0]||"";"admin"!==e||!UserStore.isAdmin()||s.adminRouter&&s.adminUtil||await Promise.all(["adminRouter","adminUtil"].map(async e=>{var t=Util.blockRelease();return l[e]=t.resolver,Util.loadScript(`/${e}.js`),t.promise}));for(t of o)if(t.test(n,r))return t.handler(a,r);if(LayoutEngine.handleScroll(),n)switch(e){case"":return LayoutEngine.setSidebarPage(i,a);case"login":return LayoutEngine.setPageInCurrentLayout("redirect",a,["/"]);case"logout":return LayoutEngine.setMonoPage("logout",a);case"cohort":return LayoutEngine.setSidebarPage("student-cohort-calendar",a,[r[1]]);case"lesson":return LayoutEngine.setSidebarPage("student-lesson-view",a,[r[1],r[2]]);case"dayview":return LayoutEngine.setSidebarPage("student-day-view",a,[r[1],r[2]]);case"settings":return LayoutEngine.setSidebarPage("account-settings",a);case"view":return LayoutEngine.setSidebarPage("student-content-view",a,r.slice(1));case"photoupload":return LayoutEngine.setSidebarPage("student-photo-upload",a);case"widgets":return LayoutEngine.setSidebarPage("widget-engine",a,[r[1]]);case"codecoffee":return LayoutEngine.setSidebarPage("code-coffee",a,[r[1]]);default:return LayoutEngine.setPageInCurrentLayout("not-found",a)}switch(e){case"login":return LayoutEngine.setMonoPage("login",a);case"register":return LayoutEngine.setMonoPage("register",a);case"oops":return LayoutEngine.setMonoPage("forgotten-password",a);case"passwordreset":return LayoutEngine.setMonoPage("forgotten-password-landing",a,[r[1]]);default:return LayoutEngine.setPageInCurrentLayout("redirect",a,["/login"])}}},d=(window.addEventListener("popstate",()=>{u!==window.location.pathname&&e(window.location.pathname)}),!1);return Util.freeze({navigate:e,addNavigationExtension:(e,t)=>{o.push({test:e,handler:t})},markExtensionsAsLoaded:e=>{s[e]=!0,l[e]&&l[e](!0)},forceNewTab:e=>{d=!!e},setLandingPageId:e=>{i=e}})})(),UserStore=(()=>{let t=null,r={},n=!1;let a=async e=>{let t={},n={};e.forEach(e=>{r[e.uid]=e,n[e.uid]=e.uid;e=e.imageToken;e&&!d[e]&&(t[e]=!0)});var e=Object.keys(t);e.length&&(e=await API.send("common.images",{tokens:e}),await o(e)),Object.values(n).forEach(i)},o=async e=>{var t,n,r,a=[],o=[];for({token:t,found:n,imageB64:r}of e.items)a.push(t),o.push(n?r:u());var i=await Promise.all(o.map(e=>"string"==typeof e?Util.loadImageB64(e):e));for(let e=0;e<a.length;e++)d[a[e]]=i[e]};let i=e=>{var t=s[e];t&&(s[e]=t.filter(e=>!!e()))},s={};let l=null,u=()=>{var e;return l||((e=(l=HTML.Canvas({canvaswidth:300,canvasheight:300})).getContext("2d")).fillStyle="#ccc",e.fillRect(0,0,300,300)),l},d={},c=e=>{e=r[e].imageToken;return d[e]||u()};return Util.freeze({getActiveUserId:()=>t,getHighResProfileImage:async e=>{var t=c(e);return 100<t.width?t:(t=r[e].imageToken,t=await API.send("common.images",{tokens:[t],fullSize:!0}),await o(t),i(e),c(e))},getProfile:e=>{e=r[e];return{...e,onlineNow:DateTime.nowInt()-e.seen<300}},getProfileImage:c,getProfileImageFingerprint:e=>{return(r[e].imageToken||"NONE")+":"+c(e).width},isAdmin:()=>n,isLoggedIn:()=>!!t,setActiveUser:async e=>{e=Util.ensureObject(e),(n=!!e.isAdmin)&&Util.loadScript("/adminSideBar.js"),(t=Math.max(Util.ensureInteger(e?e.uid:0)))&&await a([e]),Initializer.userLoaded(),LayoutEngine.tickleSidebar()},updateProfiles:a,listenToProfileChanges:(e,t)=>{s[e]||(s[e]=[]),s[e].push(t)}})})(),SideBar=(()=>{const{Div:t,Li:n,Link:o,LocText:i,Ul:s}=HTML;let l=[];let u="N/A";let d=null,e=async()=>{let r=[],a=[];d=d||await Data.loadEnrolledCohorts();var e=await(d=Util.getHumanSortedCopy(d,e=>e.name));return r.push("COHORT-BEGIN",...e.map(e=>e.id),"COHORT-END"),l.forEach(({name:e,builder:t,predicate:n})=>{n()&&(a.push(t()),r.push(e))}),r.push("NORMAL"),u=r.join("|"),t.css("sidebar")(t(t.css("sidebar__section--light")(o(i.css("sidebar__link")("NAV_DASHBOARD").set({onClick:()=>LayoutEngine.toggleSidebar()}),{navigate:"/"})),t.css("sidebar__section--medium")(t(i.css("sidebar__category")("NAV_COHORT_HEADER")),s(e.length?e.map(e=>n.css("sidebar__link")({onClick:()=>LayoutEngine.toggleSidebar()},o(e.name,{navigate:"/cohort/"+e.id}))):n(i.css("sidebar__link","sidebar__link--no-cohorts")("NAV_NO_COHORTS")))),t(a.map(e=>t(e)))))};return Util.freeze({applySideBarExtension:(e,t,n)=>{l.push({name:e,builder:n,predicate:t}),setTimeout(()=>LayoutEngine.tickleSidebar(),10)},build:e,getCurrentFingerprint:()=>(e(),u)})})(),StringTable=(()=>{let s={en:{},jp:{}},n={en:"en",ja:"ja",jp:"ja"},r=[],a=[];let i=(e,t)=>{t=n[t];t&&e.setAttribute("lang",t)},o=null,l=null;let u={},d={},c=async(e,t,n)=>{t=(t?t+"-":"")+e;if(u[t])return!0;let r;e=new Promise(e=>{r=e});return d[t]=r,Util.loadScript(n||"/strings/"+t+".js"),e},e=(t,n,r)=>(Object.keys(r).forEach(e=>{"ja"==t&&(t="jp"),s[t][n.toUpperCase()+"_"+e]=r[e]}),e);let g="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),p="X January February March April May June July August September October November December".split(" "),m=e=>!(10<=e&&e<=20)&&[0,"st","nd","rd"][e%10]||"th",h=(e,t,n)=>{switch(t&&void 0===e.mondayOffset&&(e=DateTime.toDateStruct(e)),l){case"jp":return e.year+"年 "+e.month+"月"+(n?"":" "+e.day+"日"+(t?" ("+"月火水木金土日".charAt(e.mondayOffset)+")":""));case"en":return(t?g[e.mondayOffset]+" ":"")+p[e.month]+" "+(n?"":e.day+m(e.day)+", ")+e.year}return"DATE_ERROR"};let f=e=>Util.ensureNumLength(e,2),v=(t,n)=>{switch(l){case"jp":return t.hour+":"+f(t.minute)+(n?":"+f(t.second):"");case"en":{let e=t.hour;var r=e<12;return(e=0===(e%=12)?12:e)+":"+f(t.minute)+(n?":"+f(t.second):"")+(r?" AM":" PM")}default:return"TIME_ERROR"}};let w={agoSuffix:{en:"ago",jp:"前"},futureSuffix:{en:"from now",jp:"後"},justNow:{en:"Just now",jp:"今"},second:{en:"second",jp:"秒"},seconds:{en:"seconds",jp:"秒"},minute:{en:"minute",jp:"分"},minutes:{en:"minutes",jp:"分"},hour:{en:"hour",jp:"時"},hours:{en:"hours",jp:"時"},day:{en:"day",jp:"日"},days:{en:"days",jp:"日"},never:{en:"Never",jp:"ない"}};Object.values(w).forEach(e=>{e.jp=e.en});return Util.freeze({addScopedStrings:e,addStrings:(e,t,n)=>{var r,a=Object.keys(n);let o=e;t&&(o=t+"-"+e);for(r of a){if(t&&r.split("_")[0].toUpperCase()!==t.toUpperCase())throw new Error(`The string table ${t}:${e} contains a key with an illegal prefix. All strings must begin with '${t.toUpperCase()}_'. The problematic key is ${r}.`);s[e][r]=n[r]}u[o]=!0;a=d[o];a&&a(!0)},ensureLabelSetLoaded:c,getActiveLang:()=>l,getAgoTime:(e,t)=>{if(e)return w.never[l];let n=Math.floor((new Date).getTime()/1e3-t);var r,e=n<0,t=(e&&(n*=-1),(e?w.futureSuffix:w.agoSuffix)[l]);return!e&&n<10?w.justNow[l]:n<60?`${n} ${w.seconds[l]} `+t:(e=Math.floor(n/60))<60?`${e} ${(1===e?w.minute:w.minutes)[l]} `+t:(e-=60*(r=Math.floor(e/60)),r<24?`${r} ${(1===r?w.hour:w.hours)[l]} ${e} ${(1==e?w.minute:w.minutes)[l]} `+t:(r-=24*(e=Math.floor(r/24)),`${e} ${(1===e?w.day:w.days)[l]} ${r} ${(1==r?w.hour:w.hours)[l]} `+t))},getAllLanguages:()=>["en","jp"],getFormattedDate:e=>h(e,!0),getFormattedDateTime:(e,t,n)=>h(e,t)+" "+v(e,n),getFormattedMonth:e=>h(e,!1,!0),getFormattedTime:v,getLabel:(e,t)=>{let n=s[l][e];if(void 0===n)throw new Error("Access of non-existent string table entry ("+l+"): "+e);if(0<t.length){var r=n.split("{"),a=[r[0]];for(let e=0;e<r.length;e++){var o,i=r[e].split("}",2);2===i.length&&(o=parseInt(i[0]),isNaN(o)?a.push("{",r[e]):a.push(t[o]||"",i[1]))}n=a.join("")}return n},getPreviouActiveLang:()=>o,registerOnChangeHandler:e=>{a.push(e)},setActiveLang:async e=>{if(e!==l){let t;r.push(new Promise(e=>{t=e})),await c(e,null),o=l,l=e;for(let o of document.getElementsByTagName("span"))if(o._STRING_TABLE_ARGS)if("queriedData"===o._STRING_TABLE_SPECIAL_KEY){let{fn:e,queryArgs:t,converter:n,cache:r,isHtml:a}=o._STRING_TABLE_ARGS;void 0!==r[l]?a?o.innerHTML=r[l]:o.innerText=r[l]:API.send(e,{...t,locale:l}).then(e=>{r[l]=n(e),a?o.innerHTML=r[l]:o.innerText=r[l]})}else{var n={};n[o._STRING_TABLE_SPECIAL_KEY||"text"]=o._STRING_TABLE_ARGS,o.set(n),i(o,l)}a=a.filter(e=>e()),t(!0)}},setLangAttribute:i,waitTillReady:async()=>{await Promise.all(r),r=[]}})})(),Initializer=(PageStore.registerPage("not-found",()=>{const{H1:e,Link:t}=HTML;return{authRequired:!1,urlParse:e=>[],builder:()=>HTML.scrollWrap(e("Page not found."),t("Return to dashboard",{navigate:"/"}))}}),PageStore.registerPage("redirect",{builder:e=>{let[t]=e;return Util.pause(0).then(()=>Router.navigate(t)),HTML.Div()}}),(()=>{let e=!1,t=!1,n=!1;window.addEventListener("load",()=>{e=!0,r()});let r=()=>{e&&t&&!n&&(n=!0,a())},a=async()=>{PageStore.registerValidPageIds(["account-settings","code-coffee","dashboard","forgotten-password","forgotten-password-landing","login","logout","not-found","redirect","register","student-cohort-calendar","student-content-view","student-day-view","student-lesson-view","student-photo-upload"]),await StringTable.waitTillReady(),LayoutEngine.initialize(),Router.navigate(window.location.pathname)};return{userLoaded:()=>{t=!0,r()}}})()),Branding=(()=>{let{H1:t,Span:n}=HTML,r="/branding/dig/";const e=Util.freeze({getId:()=>"dig",getLogo:()=>Util.getCachedImage(r+"logo.png"),getLogoIconOnly:()=>e.getLogo(),bgImageCount:()=>1,resDir:()=>r,getBgImageUrl:e=>r+"background"+e+".jpg",loginSidePanel:e=>{},logoutSidePanel:e=>{},loginHeaderPanel:e=>{e.append(t.css("login__title--dig")("DIG"),t.css("login__title")(n("Student Portal")))},getPrivacyPolicyUrl:()=>"https://www.codechrysalis.io/en/privacy-policy"});return e})(),Components={};Util.preRegisterComponent("ProfilePhoto"),(()=>{const{Div:g,px:p}=HTML;Util.registerComponent("ProfilePhoto",(t,e,n)=>{n=n||{},e=e||24;var r=UserStore.getProfile(t);let a=UserStore.getProfileImageFingerprint(t);var o=48<e,r=!n.disableRing&&r.isAdmin;let i=!n.disableOnline;n=!!n.linkToProfile;let s=i?g({position:"absolute",right:p(-3),bottom:p(-3),width:p(Math.floor(e/4)),height:p(Math.floor(e/4)),borderStyle:"solid",borderWidth:p(2),borderColor:"#fff",backgroundColor:"#009020",borderRadius:"50%"}):[];r=g.css(r?"profile-photo--border":null)({position:"relative",width:"100%",height:"100%",borderRadius:"50%"},s);let l=g({borderRadius:"50%",backgroundSize:"100% 100%",width:p(e),height:p(e),title:UserStore.getProfile(t).name},n?{navigate:"admin/account/view/"+UserStore.getProfile(t).id,cursor:"pointer"}:[],r),u=()=>{l.set({backgroundImage:"url("+UserStore.getProfileImage(t).toDataURL()+")"})},d=(u(),()=>{var e;i&&(e=UserStore.getProfile(t).onlineNow,s.set({display:e?"block":"none"}))}),c=(d(),!0);return setTimeout(()=>{c=!1},1e3),UserStore.listenToProfileChanges(t,()=>{var e=UserStore.getProfileImageFingerprint(t);return e!==a&&(a=e,u()),d(),c||HTML.isInDomTree(l)}),o&&UserStore.getHighResProfileImage(t),l})})(),Util.preRegisterComponent("LanguageToggle"),(()=>{const{Button:n,Div:r,Span:a}=HTML;let o=e=>{var t=StringTable.getPreviouActiveLang();return t||("en"!==e?"en":"jp")},i=e=>{switch(e){case"en":return"English";case"jp":return"日本語";default:return e}},s=(e,t)=>{t=FeatureToggle.isEnabled("lang-dropdown")?t:o(t);e.set({text:i(t)})};Util.registerComponent("LanguageToggle",()=>{let e,t;return t=FeatureToggle.isEnabled("lang-dropdown")?(e=n.css("language-buttonleft")(()=>{var e=o(StringTable.getActiveLang());API.send("account.settingsedit",{name:"lang",value:e}),StringTable.setActiveLang(e)}),a(e,n.css("language-buttonright")({html:"&#9660;"},()=>{LayoutEngine.isFloatShown()?LayoutEngine.hideFloat():LayoutEngine.createFloatWindowPrompt(r.css("user-menu__dropdown")({right:"78px",height:"inherit"},r.css("user-menu__triangle")(),r(StringTable.getAllLanguages().map(e=>n.css("user-menu__button")({height:"35px"},i(e),()=>{StringTable.setActiveLang(e),LayoutEngine.hideFloat()})))),{hideBackground:!0,includeClose:!1})}))):e=n.css("language-button")(()=>{var e=o(StringTable.getActiveLang());API.send("account.settingsedit",{name:"lang",value:e}),StringTable.setActiveLang(e)}),s(e,StringTable.getActiveLang()),StringTable.registerOnChangeHandler(()=>(s(e,StringTable.getActiveLang()),HTML.isInDomTree(e))),t})})(),Util.preRegisterComponent("MonoPageHost"),(()=>{const l=HTML["Div"];Util.registerComponent("MonoPageHost",(e,t,n)=>{var r=l.css("login-register-box")(),a=l.css("login-register-box__side-panel")(),o=l.css("login-register-box__left")(a),i=l.css("login-register-box__content")(),s=l.css("login-register-box__right")(i),o=(r.set(o,s),l.css("login-register-box-container")(r));return o.mainPanel=i,o.leftPanel=a,o})})(),Util.preRegisterComponent("OptionsDropDown"),Util.loadCssInline("/components/OptionsDropDown/style.css",".user-menu__button-list {\ndisplay: flex;\nflex-direction: column;\nheight: 100%;\nborder-radius: 0 0 0 4px;\nmargin-top: 12px;\npadding-bottom: 4px;\nbackground-color: var(--brand-color__primary--light);\n}\n.user-menu__profile-photo {\nmargin-left: 12px;\nmargin-top: 12px;\n}"),(async()=>{const{Button:e,Div:t,LocText:n}=HTML;await Util.loadComponent("ProfilePhoto"),Util.registerComponentWithCss("OptionsDropDown",()=>{return t.css("user-menu__dropdown")(t.css("user-menu__triangle")(),t.css("user-menu__profile-photo")(Components.ProfilePhoto(UserStore.getActiveUserId(),176,{disableOnline:!0})),t.css("user-menu__button-list")(e.css("user-menu__button")(n("NAV_DASHBOARD"),{navigate:"/"}),e.css("user-menu__button")(n("NAV_UPDATE_PHOTO"),{navigate:"/photoupload"}),e.css("user-menu__button")(n("NAV_SETTINGS"),{navigate:"/settings"}),e.css("user-menu__button")(n("NAV_SIGN_OUT"),{navigate:"/logout"})))})})(),Util.preRegisterComponent("ProfileTile"),(async()=>{const a=HTML["Div"];await Promise.all(["OptionsDropDown","ProfilePhoto"].map(Util.loadComponent)),Util.registerComponent("ProfileTile",e=>{if(!e)return a();UserStore.getProfile(e);var e=a({},Components.ProfilePhoto(e,30,{disableOnline:!0})),t=a.css("user-menu__arrow-icon")({html:"&#9660;"});let n,r=e=>{var t;e=e.target,LayoutEngine.isFloatShown()&&n&&((t=!(t=(e,t)=>t===e||t.contains(e))(e,LayoutEngine.getProfileTile())&&!t(e,n))&&window.removeEventListener("click",r),t)&&LayoutEngine.hideFloat()};return a.css("user-menu")({onClick:()=>{LayoutEngine.isFloatShown()?LayoutEngine.hideFloat():(n=Components.OptionsDropDown(),LayoutEngine.createFloatWindowPrompt(n,{hideBackground:!0,includeClose:!1}),window.addEventListener("click",r))}},[e,t])})})();